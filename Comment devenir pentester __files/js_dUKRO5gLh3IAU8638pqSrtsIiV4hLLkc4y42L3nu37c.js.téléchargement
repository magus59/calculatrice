/**
 * @file
 * A JavaScript file for the theme.
 *
 * In order for this JavaScript to be loaded on pages, see the instructions in
 * the README.txt next to this file.
 */

// JavaScript should be made compatible with libraries other than jQuery by
// wrapping it with an "anonymous closure". See:
// - https://drupal.org/node/1446420
// - http://www.adequatelygood.com/2010/3/JavaScript-Module-Pattern-In-Depth
(function ($, Drupal, window, document, undefined) {

jQuery(document).ready(function(){

  /*------------------------------------
   * Font Awesome
  ------------------------------------*/

  $(function() {
    $.fn.fa = function( options ) {
      options = $.extend({
        icon: "fal fa-angle-right",
        where: "before"
      }, options);

      return this.each(function() {
        var $element = $( this );
        var icon = "<i class='" + options.icon + "'></i>";
        $element[options.where]( icon );
        console.log(options);
      });
    };
  });

  // To add pseudo element before & after
  $(function() {
    $( ".list-icon-arrow-right" ).fa({
      icon: "fal fa-angle-right",
      where: "after"
    });
  });

  // To insert an icon within an element
  //$(".list-icon-arrow-right").html(function(){
    //return "<i class='fal fa-angle-right'></i>"+this.innerText;
  //});

  $("#cta-header-icon").click(function() {
    $('#cta-header-icon span').toggleClass("d-none d-block");
  });

  // To add pseudo element before & after
  // EXAMPLE
  $(function() {
    $( "#webform-component-first-name input" ).fa({
      icon: "fas fa-user fa-fw text-Gray",
      where: "after"
    });
  });
  $(function() {
    $( "#webform-component-last-name input" ).fa({
      icon: "fas fa-user fa-fw text-Gray",
      where: "after"
    });
  });
  $(function() {
    $( "#webform-component-email input" ).fa({
      icon: "fas fa-envelope fa-fw text-Gray",
      where: "after"
    });
  });


  /*------------------------------------
   * Menu Desktop
  ------------------------------------*/

  $parent_entry = $('#superfish-1 li.menuparent > .menuparent');
  if($parent_entry) $parent_entry.append('<i class="fal fa-chevron-down fa-1x ml-2"></i>');

  /*------------------------------------
   * Mmenu
  ------------------------------------*/

  $("#navbar-mobile").mmenu({
    "extensions": [
      "pagedim-black",
      "border-full",
      "listview-50"
    ]
  }, {
    // configuration
    classNames: {
      selected: "active"
    }
  });


  var $icon = $("#my-icon");
  var API = $("#navbar-mobile").data( "mmenu" );

  // Burger Menu
  $icon.on( "click", function() {
     API.open();
  });

  API.bind( "open:finish", function() {
     setTimeout(function() {
        $icon.addClass( "is-active" );
     }, 100);
  });
  API.bind( "close:finish", function() {
     setTimeout(function() {
        $icon.removeClass( "is-active" );
     }, 100);
  });

  /*------------------------------------
   * Sub-Menu Formations
  ------------------------------------*/

  var submenuTitle = $('#navbarNavDropdown a.active div').text();
  $('.submenu-formation').text(submenuTitle);

  /*------------------------------------
   * Sticky Header & Trigger Box
  ------------------------------------*/

  var stickyHeaderTop = $('#header').offset().top + $('#header').outerHeight();
  if(!$('body').hasClass('node-type-landing-page')) {
    $(window).scroll(function(){
      if( $(window).scrollTop() > stickyHeaderTop) {
        $('#header').removeClass('py-4').addClass('shrink py-2');
        $('#header > div.row').removeClass('align-items-end').addClass('align-items-center');
        $('.bean-type-trigger_box').addClass('shrink');
      } else {
        $('#header').removeClass('shrink py-2').addClass('py-4');
        $('#header > div.row').removeClass('align-items-center').addClass('align-items-end');
        $('.bean-type-trigger_box').removeClass('shrink');
      }
    });
  }
    /*------------------------------------
     * Landing page : dÃ©placement formulaire sur mobile
    ------------------------------------*/
    if (window.matchMedia("(max-width: 767px)").matches) {
      if( $('.node-type-landing-page .lp-main-content .field-name-field-inline-section').length > 0 && $('.node-type-landing-page aside .node-webform').length > 0 ){
        $('.node-type-landing-page .lp-main-content .field-name-field-inline-section').prepend($('.node-type-landing-page aside .node-webform'));
      }
    }

    /*------------------------------------
     *  Trigger Box - Close
    ------------------------------------*/

  var setCookie = function(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 60 * 60 * 1000));
    var expires = "expires=" + d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
  }

  var getCookie = function(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') c = c.substring(1);
      if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
    }
    return "";
  }

  $(function(){
    if (getCookie("closeblock") == "closed") {
      $(".bean-type-trigger_box").hide();
    }
    $(".bean-type-trigger_box .close").click(function() {
      setCookie("closeblock", "closed", 1)
    });
  });

    /*------------------------------------
   * Prefill CTA
  ------------------------------------*/

  if (document.cookie.indexOf("preFill") > 0) {
    var cookiePreFill = getCookie('preFill');

    $("a.prefill").each(function() {
      if (this.href.indexOf('?') != -1) {
        var preFill = '&' + cookiePreFill;
      } else {
        var preFill = '?' + cookiePreFill;
      }
      var $this = $(this);
      var _href = $this.attr("href");
      $this.attr("href", _href + preFill);
      console.log(cookiePreFill);
    });
  }


  /*------------------------------------
   * Slider HP
  ------------------------------------*/

  $('.slider-single').slick({
    arrows: false,
    slidesToShow: 1,
    slidesToScroll: 1,
    autoplay: true,
    autoplaySpeed: 5000,
    fade: true,
    cssEase: 'cubic-bezier(0.77, 0, 0.18, 1)',
  });

  $('.slider-event').slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    autoplay: true,
    arrows: true,
    dots: false,
    fade: true,
    infinite: true,
    prevArrow: '<button type="button" class="slick-prev left slick-arrow"></button>',
    nextArrow: '<button type="button" class="slick-next right slick-arrow"></button>',
  });

  /**
   * Youtube
   */
  ( function() {

    var youtube = document.querySelectorAll( ".youtube" );

    for (var i = 0; i < youtube.length; i++) {
      var source = "https://img.youtube.com/vi/"+ youtube[i].dataset.embed +"/sddefault.jpg";
      var image = new Image();
          image.src = source;
          image.addEventListener( "load", function() {
            youtube[ i ].appendChild( image );
          }( i ) );

          youtube[i].addEventListener( "click", function() {
            var iframe = document.createElement( "iframe" );
                iframe.setAttribute( "frameborder", "0" );
                iframe.setAttribute( "allowfullscreen", "" );
                iframe.setAttribute( "src", "https://www.youtube.com/embed/"+ this.dataset.embed +"?rel=0&showinfo=0&autoplay=1" );

                this.innerHTML = "";
                this.appendChild( iframe );
          } );
    };

  } )();


  /**
   * detect IE
   * returns version of IE or false, if browser is not Internet Explorer
   */
  (function detectIE() {
      var ua = window.navigator.userAgent;

      var msie = ua.indexOf('MSIE ');
      if (msie > 0) {
          // IE 10 or older => return version number
          var ieV = parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
          document.querySelector('body').className += ' ie';
      }

      var trident = ua.indexOf('Trident/');
      if (trident > 0) {
          // IE 11 => return version number
          var rv = ua.indexOf('rv:');
          var ieV = parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
          document.querySelector('body').className += ' ie';
      }

      var edge = ua.indexOf('Edge/');
      if (edge > 0) {
         // IE 12 (aka Edge) => return version number
         var ieV = parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
          document.querySelector('body').className += ' edge';
      }

      // other browser
      return false;
  })();

  ( function() {

    const $megamenuParentListItem = $('.megamenu-nav > li.is-parent');

    const $megamenuBackground = $('#megamenu-background');

    const isTouch = 'ontouchstart' in window || !!(navigator.msMaxTouchPoints);

    const handleMenuItemOpenState = (elem) => {
      elem.addClass('is-open');
      elem.find('a').first().attr('aria-expanded', true);
    };

    const handleMenuItemCloseState = (elem) => {
      elem.removeClass('is-open');
      elem.find('a').first().attr('aria-expanded', false);
    };

    const openMegamenu = (bgElem, heightVal) => {
      $('body').addClass('megamenu-visible');
      bgElem.height(heightVal);
    };

    const closeMegamenu = (bgElem, heightVal) => {
      $('body').removeClass('megamenu-visible');
      bgElem.height(heightVal);
    };

    const $megamenuContentElem = $('.megamenu-nav .megamenu-content');

    const getTallestMenuHeight = () => {
      let maxHeight = 0;
      $megamenuContentElem.each((index, item) => {
        if ($(item).outerHeight() > maxHeight) {
          maxHeight = $(item).outerHeight();
        }
      });
      return maxHeight;
    }

    const debouncedClose = _.debounce(closeMegamenu, 400);
    const throttledContentHeightCount = _.throttle(getTallestMenuHeight, 100);

    let megamenuContentMaxHeight = 0;

    window.onresize = () => {
      megamenuContentMaxHeight = throttledContentHeightCount();
    };

    $(() => {
      megamenuContentMaxHeight = getTallestMenuHeight();

      $megamenuParentListItem.each((index, item) => {
        if (!isTouch) {
          $(item).hoverIntent({
            sensitivity: 10,
            interval: 50,
            over: () => {
              debouncedClose.cancel();
              $megamenuParentListItem.removeClass('is-open');
              handleMenuItemOpenState($(item));
              openMegamenu($megamenuBackground, megamenuContentMaxHeight);
            },
            out: () => {
              handleMenuItemCloseState($(item));
              debouncedClose($megamenuBackground, 0);
            },
          });
        }

        $(item).find('a').first().on('click touch', () => {
          if (!$(item).hasClass('is-open')) {
            $megamenuParentListItem.removeClass('is-open');
            handleMenuItemOpenState($(item));
            openMegamenu($megamenuBackground, megamenuContentMaxHeight);
          } else {
            handleMenuItemCloseState($(item));
            closeMegamenu($megamenuBackground, 0);
          }
        });
      });

      $('#megamenu-dim').on('click touch', (e) => {
        if ($('body').hasClass('megamenu-visible')) {
          e.preventDefault();
          $megamenuParentListItem.removeClass('is-open');
          closeMegamenu($megamenuBackground, 0);
        }
      });
    });

  })();


});

// To understand behaviors, see https://drupal.org/node/756722#behaviors


})(jQuery, Drupal, this, this.document);
;
;(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define(['jquery'], factory);
  } else if (typeof exports === 'object') {
    module.exports = factory(require('jquery'));
  } else {
    root.jquery_mhead_js = factory(root.jQuery);
  }
}(this, function(jQuery) {
/*
 * jQuery mhead v1.0.2
 * @requires jQuery 1.7.0 or later
 *
 * mmenu.frebsite.nl/mhead-plugin
 *
 * Copyright (c) Fred Heusschen
 * www.frebsite.nl
 *
 * License: CC-BY-4.0
 * http://creativecommons.org/licenses/by/4.0/
 */
!function(t){function i(){t[n].glbl||(a={$wndw:t(window),$docu:t(document),$html:t("html"),$body:t("body")},o={},r={},h={},t.each([o,r,h],function(t,i){i.add=function(t){t=t.split(" ");for(var n=0,s=t.length;n<s;n++)i[t[n]]=i.mh(t[n])}}),o.mh=function(t){return"mh-"+t},o.add("head sticky scrolledout align btns list hamburger"),o.umh=function(t){return"mh-"==t.slice(0,3)&&(t=t.slice(3)),t},r.mh=function(t){return"mh-"+t},h.mh=function(t){return t+".mh"},h.add("scroll click"),t[n]._c=o,t[n]._d=r,t[n]._e=h,t[n].glbl=a)}var n="mhead",s="1.0.2";if(!(t[n]&&t[n].version>s)){t[n]=function(t,i,n){return this.$head=t,this.opts=i,this.conf=n,this._initButtons(),this._initList(),this._initHamburger(),this._initScroll(),this},t[n].version=s,t[n].defaults={scroll:{hide:0,show:0,tolerance:4},hamburger:{menu:null,animation:"collapse"}},t[n].configuration={initButtons:!0,initList:!0,initHamburger:!0,initScroll:!0},t[n].prototype={_initButtons:function(){if(!this.conf.initButtons)return this;var t=!1,i={left:0,right:0},n=0,s=0;for(var r in i)t=t||this.$head.hasClass(o.align+"-"+r),(n=this.$head.children("."+o.btns+"-"+r).children().length)&&(s=Math.max(n,s),i[r]=n);if(!t)for(var r in i)i[r]=s;for(var r in i)if(i[r]){var h=o.btns+"-"+r;i[r]>1&&(h+="-"+i[r]),this.$head.addClass(h)}return this},_initList:function(){return this.conf.initList?void this.$head.find("."+o.list).each(function(){t(this).children().appendTo(this)}):this},_initScroll:function(){if(!this.conf.initScroll)return this;if(!this.opts.scroll||this.opts.scroll.hide===!1)return this;this.$head.hasClass(o.sticky)||this.$head.addClass(o.sticky);var t=this,i=0,n=null,s=this.$head.offset().top+this.$head.outerHeight();return this.opts.scroll.hide=Math.max(s,this.opts.scroll.hide||0),this.opts.scroll.show=Math.max(s,this.opts.scroll.show||0),a.$wndw.on(h.scroll,function(){var s=a.$wndw.scrollTop(),r=i-s,h=r<0?"down":"up";r=Math.abs(r),i=s,null===n&&(n=s>t.opts.scroll.show),n?"up"==h&&(s<t.opts.scroll.show||r>t.opts.scroll.tolerance)&&(n=!1,t.$head.removeClass(o.scrolledout)):"down"==h&&s>t.opts.scroll.hide&&r>t.opts.scroll.tolerance&&(n=!0,t.$head.addClass(o.scrolledout))}).trigger(h.scroll),this},_initHamburger:function(){if(!this.conf.initHamburger)return this;var i=this.$head.find("."+o.hamburger);if(i.length){var n=this;return i.each(function(){var i=t(this),s=t('<button class="hamburger"><span class="hamburger-box"><span class="hamburger-inner"></span></span></button>'),o=i.attr("href");i.replaceWith(s),s.addClass("hamburger--"+n.opts.hamburger.animation);for(var r=t(),a=[o,n.opts.hamburger.menu,".mm-menu"],e=0;e<a.length;e++)if(a[e]&&(r=t(a[e]),r.length&&r.is(".mm-menu"))){r=r.first();break}var l=r.data("mmenu");s.on(h.click,function(){l.open()}),l.bind("open:finish",function(){setTimeout(function(){s.addClass("is-active")},100)}),l.bind("close:finish",function(){setTimeout(function(){s.removeClass("is-active")},100)})}),this}}},t.fn[n]=function(s,o){return i(),s=t.extend(!0,{},t[n].defaults,s),o=t.extend(!0,{},t[n].configuration,o),this.each(function(){var i=t(this);if(!i.data(n)){var r=new t[n](i,s,o);i.data(n,r)}})},t[n].support={touch:"ontouchstart"in window||navigator.msMaxTouchPoints||!1};var o,r,h,a}}(jQuery);
return true;
}));
;
